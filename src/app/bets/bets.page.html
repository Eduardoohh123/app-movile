<ion-header class="custom-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <div class="title-wrapper">
        <ion-icon name="cash-outline"></ion-icon>
        <span>Mis Apuestas</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bets-content">
  
  <!-- User Statistics Card -->
  <div class="stats-card premium-card" *ngIf="userStats.totalBets > 0">
    <div class="card-glow"></div>
    <div class="stats-header">
      <div class="user-badge">
        <ion-icon name="person-circle"></ion-icon>
        <span class="user-name">{{ currentUserName }}</span>
      </div>
      <div class="win-rate-badge" [class.high]="userStats.winRate >= 60" [class.medium]="userStats.winRate >= 40 && userStats.winRate < 60" [class.low]="userStats.winRate < 40">
        <ion-icon name="trophy"></ion-icon>
        <span>{{ userStats.winRate }}% Éxito</span>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-icon-wrapper total">
          <ion-icon name="ticket"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ userStats.totalBets }}</span>
          <span class="stat-label">Total Apuestas</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon-wrapper success">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ userStats.won }}</span>
          <span class="stat-label">Ganadas</span>
          <div class="stat-progress">
            <div class="progress-bar success" [style.width.%]="(userStats.won / userStats.totalBets) * 100"></div>
          </div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon-wrapper pending">
          <ion-icon name="time"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ userStats.pending }}</span>
          <span class="stat-label">Pendientes</span>
          <div class="stat-progress">
            <div class="progress-bar pending" [style.width.%]="(userStats.pending / userStats.totalBets) * 100"></div>
          </div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon-wrapper" [class.profit]="userStats.profitLoss > 0" [class.loss]="userStats.profitLoss < 0">
          <ion-icon [name]="userStats.profitLoss >= 0 ? 'trending-up' : 'trending-down'"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value" [class.profit]="userStats.profitLoss > 0" [class.loss]="userStats.profitLoss < 0">
            {{ userStats.profitLoss >= 0 ? '+' : '' }}${{ userStats.profitLoss | number:'1.2-2' }}
          </span>
          <span class="stat-label">Balance Total</span>
          <div class="stat-progress">
            <div class="progress-bar" [class.profit]="userStats.profitLoss > 0" [class.loss]="userStats.profitLoss < 0" [style.width.%]="75"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Bet Button -->
  <div class="create-bet-section">
    <ion-button expand="block" (click)="openBetDetail()" class="create-bet-btn">
      <div class="btn-content">
        <div class="btn-glow"></div>
        <ion-icon name="add-circle"></ion-icon>
        <span class="btn-text">Nueva Apuesta</span>
      </div>
    </ion-button>
  </div>

  <!-- Search and Filters Section -->
  <div class="search-section">
    <div class="search-wrapper" [class.focused]="isSearchFocused">
      <div class="search-icon-wrapper">
        <ion-icon name="search" class="search-icon"></ion-icon>
      </div>
      <ion-searchbar
        placeholder="Buscar por partido, liga o predicción..."
        [(ngModel)]="searchQuery"
        (ionInput)="onSearchChange($event)"
        (ionFocus)="isSearchFocused = true"
        (ionBlur)="isSearchFocused = false"
        debounce="300"
        animated>
      </ion-searchbar>
      <div class="search-results-count" *ngIf="searchQuery">
        <span>{{ filteredBets.length }} resultado{{ filteredBets.length !== 1 ? 's' : '' }}</span>
      </div>
    </div>

    <!-- Status Filter - Simplified -->
    <ion-segment [(ngModel)]="selectedStatus" (ionChange)="onStatusChange($event)">
      <ion-segment-button value="all">
        <ion-label>Todas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="pending">
        <ion-label>Activas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="won">
        <ion-label>Ganadas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="lost">
        <ion-label>Perdidas</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Bets Grid -->
  <div class="bets-grid" *ngIf="filteredBets.length > 0">
    <div class="bet-card" *ngFor="let bet of filteredBets" (click)="openBetDetail(bet, $event)">

      <!-- Match Header -->
      <div class="bet-header">
        <div class="match-name">
          <ion-icon name="football-outline"></ion-icon>
          <span>{{ bet.matchName }}</span>
        </div>
        <div class="league-badge">
          <ion-icon name="trophy-outline"></ion-icon>
          <span>{{ bet.league }}</span>
        </div>
      </div>

      <!-- Bet Info -->
      <div class="bet-info-grid">
        <div class="info-item">
          <span class="label">Tipo</span>
          <span class="value">{{ getBetTypeLabel(bet.betType) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Predicción</span>
          <span class="value prediction">{{ bet.prediction }}</span>
        </div>
        <div class="info-item">
          <span class="label">Cuota</span>
          <span class="value odds">{{ bet.odds }}</span>
        </div>
        <div class="info-item">
          <span class="label">Apostado</span>
          <span class="value stake">${{ bet.stake | number:'1.2-2' }}</span>
        </div>
      </div>

      <!-- Potential Win -->
      <div class="potential-win">
        <ion-icon name="trending-up-outline"></ion-icon>
        <span>Ganancia Potencial: <strong>${{ bet.potentialWin | number:'1.2-2' }}</strong></span>
      </div>

      <!-- Match Date -->
      <div class="bet-footer">
        <span class="match-date">
          <ion-icon name="calendar-outline"></ion-icon>
          {{ formatDate(bet.matchDate) }}
        </span>
        <span class="placed-date">
          <ion-icon name="time-outline"></ion-icon>
          {{ bet.placedAt | date:'short' }}
        </span>
      </div>

      <!-- Notes -->
      <div class="bet-notes" *ngIf="bet.notes">
        <ion-icon name="document-text-outline"></ion-icon>
        <span>{{ bet.notes }}</span>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <ion-button size="small" fill="outline" color="success" (click)="settleBet(bet, 'won', $event)">
          <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
          Ganada
        </ion-button>
        <ion-button size="small" fill="outline" color="danger" (click)="settleBet(bet, 'lost', $event)">
          <ion-icon name="close-circle-outline" slot="start"></ion-icon>
          Perdida
        </ion-button>
        <ion-button size="small" fill="clear" color="warning" (click)="cancelBet(bet, $event)">
          <ion-icon name="ban-outline" slot="start"></ion-icon>
          Cancelar
        </ion-button>
        <ion-button size="small" fill="clear" color="danger" (click)="deleteBet(bet, $event)" class="delete-action-btn">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          Eliminar
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredBets.length === 0">
    <ion-icon name="ticket-outline"></ion-icon>
    <h3>No hay apuestas</h3>
    <p>No tienes apuestas registradas todavía.</p>
    <ion-button (click)="generateSampleData()">
      <ion-icon name="cube-outline" slot="start"></ion-icon>
      Generar Ejemplos
    </ion-button>
  </div>

  <!-- FAB Menu -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button>
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button color="primary" (click)="openBetDetail()">
        <ion-icon name="add-circle-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="secondary" (click)="generateSampleData()">
        <ion-icon name="cube-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="danger" (click)="clearAllBets()">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>

</ion-content>
